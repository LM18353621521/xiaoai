<!-- 登录/注册浮层 -->
<div class="login-layer login-register">
    <div class="login-layer-content">
        <img class="layer-close" src="__STATIC__/home/common/images/layer-close.png">
        <div class="tab-title-wrapper">
            <p class="tab-title active">登录</p>
            <p class="tab-title">注册</p>
        </div>
        <div class="layer-two-tab">
            <div class="layer-tab-one">
                <!-- 登录 -->
                <div class="layer-tab-item">
                    <!-- 密码登录 -->
                    <div class="login-type login-a">
                        <form action="">
                            <div class="layer-input-box">
                                <img src="__STATIC__/home/common/images/person.png">
                                <input type="text" placeholder="手机号/靓号登录" id="login_username" name="username">
                            </div>
                            <div class="layer-input-box">
                                <img src="__STATIC__/home/common/images/password.png">
                                <input type="password" placeholder="请输入密码" id="login_password" name="password">
                            </div>
                            <div class="next-login-wrapper">
                                <p class="next-login"><span class="active"><img
                                        src="__STATIC__/home/common/images/yes.png"></span>记住密码</p>
                                <p class="find-password">找回密码</p>
                            </div>
                            <p class="login-btn login_do">登录</p>
                        </form>
                    </div>
                    <!-- 短信登录 -->
                    <div class="login-type login-b">
                        <div class="layer-input-box">
                            <img src="__STATIC__/home/common/images/person.png">
                            <input type="text" placeholder="请输入手机号码" name="">
                        </div>
                        <div class="layer-input-box getnum">
                            <img src="__STATIC__/home/common/images/password.png">
                            <input type="text" placeholder="请输入验证码" name="">
                            <p class="get-num">获取验证码</p>
                        </div>
                        <div class="next-login-wrapper">
                            <p class="next-login"><span class="active"><img
                                    src="__STATIC__/home/common/images/yes.png"></span>记住密码</p>
                            <p class="find-password">找回密码</p>
                        </div>
                        <p class="login-btn">登录</p>
                    </div>
                    <!-- 扫码登录 -->
                    <div class="login-type login-c">
                        <div class="code-box">
                            <div class="code-code"><img src="__STATIC__/home/common/images/wechata.png"></div>
                            <p>打开手机微信，扫描二维码</p>
                        </div>
                    </div>
                </div>
                <!-- 注册 -->
                <div class="layer-tab-item">
                    <form action="" id="form_reg">
                        <div class="layer-input-box">
                            <img src="__STATIC__/home/common/images/person.png">
                            <input type="text" placeholder="请输入手机号码" name="username" id="reg_username">
                        </div>
                        <div class="layer-input-box getnum">
                            <img src="__STATIC__/home/common/images/password.png">
                            <input type="text" placeholder="请输入验证码" name="code" id="reg_code">
                            <p class="get-num" id="get_code">获取验证码</p>
                        </div>
                        <div class="layer-input-box">
                            <img src="__STATIC__/home/common/images/password.png">
                            <input type="password" placeholder="请输入密码" name="password" id="reg_password">
                        </div>
                        <p class="login-btn reg_do">注册</p>
                    </form>
                </div>
            </div>
            <div class="layer-tab-two">
                <p class="other-title">其他登录方式</p>
                <p class="other-login account-icon"  onclick="account_login()">
                    <img src="__STATIC__/home/common/images/login-account.png">账号登录 </p>
                <p class="other-login" onclick="weixin_login()"><img src="__STATIC__/home/common/images/login-wechat.png">微信登录</p>
                <p class="other-login">
                    <a href="{:url('Login/qq_login')}"> <img src="__STATIC__/home/common/images/login-qq.png">QQ登录</a>
                </p>
            </div>
        </div>
    </div>
</div>
<!-- 绑定账号浮层 -->
<div class="login-layer bind-account">
    <form action="" id="bind_form">
    <div class="login-layer-content">
        <img class="layer-close" src="__STATIC__/home/common/images/layer-close.png">
        <div class="tab-title-wrapper">
            <p class="tab-title active">绑定手机号</p>
        </div>
        <div class="layer-two-tab">
            <div class="layer-tab-one">
                <div class="layer-tab-item">
                    <div class="layer-input-box margin-top">
                        <input type="text" placeholder="请输入手机号码" name="mobile" id="bind_mobile">
                    </div>
                    <div class="layer-input-box">
                        <input type="text" placeholder="请输入验证码" name="code" id="bind_code">
                        <p class="get-num get_bind_code" id="get_bind_code">发送验证码</p>
                    </div>
                    <p class="login-btn bind_btn">确认绑定</p>
                </div>
            </div>
            <!--<div class="layer-tab-two">-->
                <!--<p class="other-title">其他登录方式</p>-->
                <!--<p class="other-login"  onclick="account_login()"><img src="__STATIC__/home/common/images/login-account.png">账号登录</p>-->
                <!--<p class="other-login"  onclick="weixin_login()"><img src="__STATIC__/home/common/images/login-wechat.png">微信登录</p>-->
                <!--<p class="other-login">-->
                    <!--<a href="{:url('Login/qq_login')}"><img  src="__STATIC__/home/common/images/login-qq.png">QQ登录</a>-->
                <!--</p>-->
            <!--</div>-->
        </div>
    </div>
    </form>
</div>
<!-- 找回密码浮层 -->
<div class="login-layer find-passwords">
    <div class="login-layer-content">
        <img class="layer-close" src="__STATIC__/home/common/images/layer-close.png">
        <div class="tab-title-wrapper">
            <p class="tab-title active">找回密码</p>
        </div>
        <div class="layer-two-tab">
            <div class="layer-tab-one">
                <form action="" id="form_find">
                <div class="layer-tab-item">
                    <!-- 第一步:输入手机号 -->
                    <div class="find-type find-a" style="display: block">
                        <div class="layer-input-box">
                            <img src="__STATIC__/home/common/images/person.png">
                            <input type="text" placeholder="输入手机号码"  name="mobile" id="find_mobile">
                        </div>
                        <p class="login-btn find-btn find_password1">下一步</p>
                    </div>
                    <!--  第二步:输入手机号 -->
                    <div class="find-type find-b"  style="display: none">
                        <p class="send-message">短信验证码已发送 <em id="find_mobiles"></em>，请查收</p>
                        <div class="layer-input-box">
                            <img src="__STATIC__/home/common/images/email.png">
                            <input type="text" placeholder="请输入验证码" name="code" id="find_code">
                            <p class="get-num" id="get_find_code">获取验证码</p>
                        </div>
                        <p class="login-btn find-btn find_password2">下一步</p>
                    </div>
                    <!-- 第三步:填写新密码 -->
                    <div class="find-type find-c"  style="display: none">
                        <p class="send-message-tips">8-20位字母，数字或字母，至少包含两种</p>
                        <div class="layer-input-boxa">
                            <p>新密码</p>
                            <input type="password" placeholder="请输入密码" id="find_password" name="password">
                        </div>
                        <div class="layer-input-boxa">
                            <p>确认密码</p>
                            <input type="password" placeholder="请再次输入密码" id="find_password1" name="find_password1">
                        </div>
                        <p class="login-btn  find-btn find_password3">确认修改</p>
                    </div>
                </div>
                </form>
            </div>
            <div class="layer-tab-two">
                <p class="other-title">其他登录方式</p>
                <p class="other-login"  onclick="account_login()"><img src="__STATIC__/home/common/images/login-account.png">账号登录</p>
                <p class="other-login"  onclick="weixin_login()"><img src="__STATIC__/home/common/images/login-wechat.png">微信登录</p>
                <p class="other-login"><a href="{:url('Login/qq_login')}"><img src="__STATIC__/home/common/images/login-qq.png">QQ登录</a></p>
            </div>
        </div>
    </div>
</div>
<script>
    var is_login = "{$is_login}";
    //账号登录
    function account_login(){
        $(".login-layer").hide();
        $(".login-register").show();
    }
    $(function () {
        if(is_login==1){
            var is_bind = getCookie('is_bind');
            var bind_tips=getCookie('bindTips');
            if(is_bind==0&&bind_tips!=1){
                setCookies('bindTips',1);
                $(".bind-account").show();
            }
        }
        // 登录
        $(".login-before").click(function () {
            $(".login-layer").hide();
            $(".login-register").show();
        })
        // 关闭浮层
        $(".layer-close").click(function () {
            $(this).parents(".login-layer").hide();
        })
        // 浮沉tab切换
        $(".tab-title").click(function () {
            $(this).addClass("active").siblings().removeClass("active");
            var _index = $(this).index();
            $(".layer-tab-item").eq(_index).show().siblings().hide();
        })
        // 下次自动登录
        $(".next-login span").click(function () {
            if ($(this).hasClass("active")) {
                $(this).removeClass("active");
            } else {
                $(this).addClass("active");
            }
        })
        // 账号登录
        $(".account").click(function () {
            $(".login-type").hide();
            $(".login-a").show();
        })
        // 短信登录
        $(".message-icon").click(function () {
            $(".login-type").hide();
            $(".login-b").show();
            $(".message-icon").hide();
            $(".account-icon").show();
        })
        // 找回密码
        $(".find-password").click(function () {
            $(".login-layer").hide();
            $(".find-passwords").show();
        })
        // 找回密码
        $(".find_password1").click(function () {
            var mobile = $("#find_mobile").val();
            if(!checkMobile(mobile)){
                layer.msg('请输入正确的手机号码', {icon: 2});
                return;
            }
            if (can_click==0){return false}
            can_click=0;
            $.post("/Home/Login/check_find_mobile", {mobile:mobile}, function (data) {
                if (data.ret == 1) {
                    get_find_code();
                    $("#find_mobiles").text(mobile);
                    $(".find-a").hide();
                    $(".find-b").show();
                    $("#find_code").val("");
                    can_click=1;
                } else {
                    layer.msg(data.msg,{icon:2});
                    can_click=1;
                }
            });
        });
        $(".find_password2").click(function () {
            var mobile = $("#find_mobile").val();
            var code = $("#find_code").val();
            if(!checkMobile(mobile)){
                layer.msg('请输入正确的手机号码', {icon: 2});
                return;
            }
            if(!code){
                layer.msg('请输入验证码', {icon: 2});
                return;
            }
            if (can_click==0){return false}
            can_click=0;
            $.post("/Home/Login/check_find_code", {mobile:mobile,code:code}, function (data) {
                if (data.ret == 1) {
                    can_click=1;
                    $(".find-a").hide();
                    $(".find-b").hide();
                    $(".find-c").show();
                } else {
                    layer.msg(data.msg,{icon:2});
                    can_click=1;
                }
            });
        });
        $(".find_password3").click(function () {
            var mobile = $("#find_mobile").val();
            var code = $("#find_code").val();
            var password = $.trim($("#find_password").val());
            var password1 = $("#find_password1").val();
            if(!checkMobile(mobile)){
                layer.msg('请输入正确的手机号码', {icon: 2});
                return;
            }
            if(!code){
                layer.msg('请输入验证码', {icon: 2});
                return;
            }
            if(password==""){
                layer.msg("请输入密码",{icon:2});
                return false;
            }
            if(password.length<6){
                layer.msg("请输入不小于6位的密码",{icon:2});
                return false;
            }
            if(password!=password1){
                layer.msg("两次密码输入不一致",{icon:2});
                return false;
            }
            if (can_click==0){return false}
            can_click=0;
            var data = $('#form_find').serialize();
            $.post("/Home/Login/find_password", data, function (data) {
                if (data.ret == 1) {
                    layer.msg(data.msg,{icon:1},function () {
                        window.location.reload();
                    });
                } else {
                    layer.msg(data.msg,{icon:2});
                    can_click=1;
                }
            });
        });

        $("#get_find_code").click(function () {
            var mobilephone = $("#find_mobile").val();
            if (mobilephone == '') {
                layer.msg("手机号码不能为空",{icon:2});
                return false;
            }
            if(can_get_code==0){return false};
            get_find_code();
        });

        //发送绑定手机号码
        $("#get_bind_code").click(function () {
            var mobilephone = $("#bind_mobile").val();
            if (mobilephone == '') {
                layer.msg("手机号码不能为空",{icon:2});
                return false;
            }
            if(can_get_code==0){return false};
            get_bind_code();
        });

        $(".bind_btn").click(function () {
            var mobile = $("#bind_mobile").val();
            var code = $("#bind_code").val();
            if(!checkMobile(mobile)){
                layer.msg('请输入正确的手机号码', {icon: 2});
                return;
            }
            if(!code){
                layer.msg('请输入验证码', {icon: 2});
                return;
            }
            if (can_click==0){return false}
            can_click=0;
            var data = $('#bind_form').serialize();
            $.post("/Home/Login/bind_mobile", data, function (data) {
                if (data.ret == 1) {
                    layer.msg(data.msg,{icon:1},function () {
                        window.location.reload();
                    });
                } else {
                    layer.msg(data.msg,{icon:2});
                    can_click=1;
                }
            });
        });

    });
    function weixin_login() {
        var weixin ="{$weixin_login_info['oauth_url']}";
        location.href=weixin;
    }

    function checkMobile(tel) {
        var reg = /^1[0-9]{10}$/;
        if (reg.test(tel)) {
            return true;
        }else{
            return false;
        };
    }
    can_get_code=1;
    function get_find_code() {
        if(can_get_code==0){return false};
        var mobile = $("#find_mobile").val();
        $.post('/Home/Api/sendSmsCode', {mobile: mobile,type:3}, function (data) {
            if (data.ret == 1) {
                //发送成功
                time = 60;//秒
                countdown = time;
                var setSmsTime = function () {
                    if (countdown == 0) {
                        can_get_code = 1;
                        $('#get_find_code').css('background', '#b730b0').text('获取验证码');
                        countdown = time;
                        clearInterval(aa);
                    } else {
                        $('#get_find_code').css('background', '#ccc').text(countdown + 's');
                        countdown--;
                    }
                }
                var aa = setInterval(function () {
                    setSmsTime()
                }, 1000);
            } else {
                can_get_code = 1;
                layer.msg(data.msg,{icon:2});
                return false;
            }
        }, 'json');
    }

    var so
    function get_bind_code() {
        if(can_get_code==0){return false};
        var mobile = $("#bind_mobile").val();
        can_get_code=0;
        $.post('/Home/Api/sendSmsCode', {mobile: mobile,type:4}, function (data) {
            if (data.ret == 1) {
                //发送成功
                time = 60;//秒
                countdown = time;
                var setSmsTime = function () {
                    if (countdown == 0) {
                        can_get_code = 1;
                        $('#get_bind_code').css('background', '#b730b0').text('获取验证码');
                        countdown = time;
                        clearInterval(aa);
                    } else {
                        $('#get_bind_code').css('background', '#ccc').text(countdown + 's');
                        countdown--;
                    }
                }
                var aa = setInterval(function () {
                    setSmsTime()
                }, 1000);
            } else {
                can_get_code = 1;
                layer.msg(data.msg,{icon:2});
                return false;
            }
        }, 'json');
    }

</script>